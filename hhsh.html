<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¥½å¥½ç”Ÿæ´»</title>
<link rel="icon" type="image/png" href="/images/icons/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/images/icons/favicon.svg" />
<link rel="shortcut icon" href="/images/icons/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/images/icons/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="MyWebSite" />
<link rel="manifest" href="/images/icons/site.webmanifest" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-color: #f9f7f2;
      --card-bg: white;
      --text-color: #333;
      --border-color: #eee;
      --feedback-bg: #e8f5e9;
      --feedback-color: #33691e;
    }

    body {
      font-family: 'Noto Sans SC', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
      padding: 20px;
      transition: background-color 0.3s;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      position: relative;
    }

    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin: 20px 0 10px;
      color: #5a5a5a;
    }

    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 20px;
      font-size: 0.95rem;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
    }

    .subtitle-text {
      margin-right: 6px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .subtitle-text.visible {
      opacity: 1;
    }

    .mars {
      font-size: 1.2rem;
      cursor: pointer;
      color: #bbb;
      transition: color 0.3s, text-shadow 0.3s;
    }

    .mars.lit {
      color: #e91e63;
      text-shadow: 0 0 8px rgba(233, 30, 99, 0.5);
    }

    .tip {
      background: var(--feedback-bg);
      padding: 14px;
      border-radius: 12px;
      margin: 20px auto;
      max-width: 600px;
      font-size: 0.95rem;
      color: var(--feedback-color);
      text-align: center;
      border-left: 3px solid #4caf50;
      display: none;
    }

    .section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.03);
      border: 1px solid var(--border-color);
    }

    .section-title {
      font-size: 1.2rem;
      color: #444;
      margin: 0 0 16px 0;
    }

    .section-title small {
      display: block;
      font-size: 0.8rem;
      color: #757575;
      margin-top: 4px;
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .option-card {
      border: 2px solid var(--border-color);
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      background: var(--card-bg);
    }

    .option-card:hover {
      border-color: #bbdefb;
    }

    .option-card.selected {
      border-color: #2196f3;
      background-color: #e3f2fd;
    }

    .option-img {
      width: 100%;
      height: 80px;
      object-fit: cover;
      background: #f5f5f5;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:bold;
      font-size:1.5rem;
    }

    .option-label {
      padding: 8px 4px;
      font-size: 0.95rem;
      font-weight: 500;
    }

    .option-desc {
      font-size: 0.8rem;
      color: #757575;
      padding: 0 4px 8px;
    }

    .module-feedback {
      margin-top: 16px;
      padding: 10px 16px;
      background: var(--feedback-bg);
      color: var(--feedback-color);
      border-radius: 12px;
      font-size: 0.95rem;
      text-align: center;
      opacity: 0;
      transform: translateY(5px);
      transition: opacity 0.3s, transform 0.3s;
      max-width: 90%;
      margin-left: auto;
      margin-right: auto;
      word-break: break-word;
      line-height: 1.4;
    }

    .module-feedback.show {
      opacity: 1;
      transform: translateY(0);
    }

    .module-feedback small {
      display: block;
      margin-top: 6px;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    .tab-btn {
      padding: 8px 16px;
      background: #eee;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .tab-btn.active {
      background: #2196f3;
      color: white;
    }

    .stat-item {
      padding: 12px 0;
      border-bottom: 1px dashed var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .stat-item.counts {
      justify-content: space-between;
    }

    .stat-trend {
      font-size: 1.1rem;
      margin-left: 8px;
      color: #555;
    }

    .no-data {
      text-align: center;
      color: #999;
      padding: 20px;
      font-style: italic;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .nav-buttons {
      text-align: center;
      margin-top: 20px;
    }

    .nav-buttons button {
      padding: 10px 20px;
      margin: 0 8px;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 1rem;
    }

    .nav-buttons button.secondary {
      background: #9e9e9e;
    }

    /* === éšç§æ¨¡æ€æ¡† === */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s;
    }

    .modal.show {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      padding: 24px;
      border-radius: 16px;
      max-width: 400px;
      width: 90%;
      text-align: center;
    }

    .modal h3 {
      margin-bottom: 16px;
      color: #333;
    }

    .modal p {
      margin: 12px 0;
      color: #666;
      font-size: 0.95rem;
    }

    .modal-buttons {
      margin-top: 20px;
    }

    .modal-buttons button {
      padding: 8px 16px;
      margin: 0 6px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
    }

    .btn-delete {
      background: #f44336;
      color: white;
    }

    .btn-cancel {
      background: #e0e0e0;
    }

    .btn-complete {
      background: #4caf50;
      color: white;
    }

    /* åˆ é™¤æˆåŠŸæç¤ºæ ·å¼ */
    .delete-success {
      color: #4caf50;
      font-weight: 500;
      margin: 10px 0;
      display: none;
    }

    /* è®¾ç½®å›¾æ ‡æ ·å¼ï¼ˆæ›¿ä»£éšç§è¯´æ˜ï¼‰ */
    .settings-icon {
      position: absolute;
      bottom: 10px;
      right: 20px; /* å³ç§»ï¼Œæ¯”åŸæ¥çš„10pxå¤š */
      font-size: 1.2rem; /* å›¾æ ‡æ›´å¤§æ›´æ˜¾çœ¼ */
      color: #888;
      cursor: pointer;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .settings-icon:hover {
      color: #555;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>å¥½å¥½ç”Ÿæ´»</h1>
    <p class="subtitle">
      <span id="subtitle-text" class="subtitle-text">ä¸€èµ·æ´»ç€</span>
      <span id="mars-icon" class="mars">ğŸŒ•</span>
    </p>

    <!-- æ‰“å¡é¡µ -->
    <div id="main-page" class="page active">
      <!-- ç¡çœ  -->
      <div class="section">
        <h2 class="section-title">ç¡çœ <br><small>è®°å¾—åä¸€ç‚¹å‰å…¥ç¡å“¦</small></h2>
        <div class="options-grid" data-category="sleep">
          <div class="option-card" data-value="ç¡å¾—å¾ˆå¥½">
            <div class="option-img" style="background:#e8f5e8;color:#4caf50;">ğŸ˜´</div>
            <div class="option-label">ç¡å¾—å¾ˆå¥½</div>
            <div class="option-desc">ä¸€è§‰åˆ°å¤©äº®</div>
          </div>
          <div class="option-card" data-value="å¤±çœ äº†">
            <div class="option-img" style="background:#ffebee;color:#f44336;">ğŸ˜µ</div>
            <div class="option-label">å¤±çœ äº†</div>
            <div class="option-desc">éš¾ä»¥å…¥çœ </div>
          </div>
          <div class="option-card" data-value="æ—©é†’äº†">
            <div class="option-img" style="background:#fff8e1;color:#ff9800;">ğŸŒ…</div>
            <div class="option-label">æ—©é†’äº†</div>
            <div class="option-desc">é†’å¾—è¿‡æ—©</div>
          </div>
          <div class="option-card" data-value="ä¸­é€”é†’äº†">
            <div class="option-img" style="background:#e3f2fd;color:#2196f3;">ğŸŒƒ</div>
            <div class="option-label">ä¸­é€”é†’äº†</div>
            <div class="option-desc">å¤šæ¬¡é†’æ¥</div>
          </div>
          <div class="option-card" data-value="æ·±ç¡å°‘">
            <div class="option-img" style="background:#e0f7fa;color:#0097a7;">ğŸ¥±</div>
            <div class="option-label">æ·±ç¡å°‘</div>
            <div class="option-desc">æµ…ç¡ä¸ºä¸»</div>
          </div>
          <div class="option-card" data-value="åšå™©æ¢¦äº†">
            <div class="option-img" style="background:#f3e5f5;color:#9c27b0;">ğŸ˜±</div>
            <div class="option-label">åšå™©æ¢¦äº†</div>
            <div class="option-desc">æ¢¦å¢ƒå›°æ‰°</div>
          </div>
        </div>
        <div class="module-feedback"></div>
      </div>

      <!-- é¥®é£Ÿ -->
      <div class="section">
        <h2 class="section-title">é¥®é£Ÿ<br><small>æ²‰æµ¸äº«å—ç¾é£Ÿï¼Œç»†åš¼æ…¢å’½</small></h2>
        <div class="options-grid" data-category="food">
          <div class="option-card" data-value="åƒå¾—æ­£å¥½">
            <div class="option-img" style="background:#e8f5e8;color:#4caf50;">ğŸš</div>
            <div class="option-label">åƒå¾—æ­£å¥½</div>
            <div class="option-desc">è¥å…»å‡è¡¡</div>
          </div>
          <div class="option-card" data-value="æ²¡æŒ‰æ—¶åƒ">
            <div class="option-img" style="background:#fff8e1;color:#ff9800;">â°</div>
            <div class="option-label">æ²¡æŒ‰æ—¶åƒ</div>
            <div class="option-desc">ä½œæ¯ä¸è§„å¾‹</div>
          </div>
          <div class="option-card" data-value="æ²¡åƒé¥±">
            <div class="option-img" style="background:#ffebee;color:#f44336;">ğŸ½ï¸</div>
            <div class="option-label">æ²¡åƒé¥±</div>
            <div class="option-desc">è¥å…»ä¸è¶³</div>
          </div>
          <div class="option-card" data-value="åƒæ’‘äº†">
            <div class="option-img" style="background:#f3e5f5;color:#9c27b0;">ğŸ</div>
            <div class="option-label">åƒæ’‘äº†</div>
            <div class="option-desc">è¿‡é‡è¿›é£Ÿ</div>
          </div>
          <div class="option-card" data-value="è¾›è¾£ç”Ÿå†·æ²¹è…»">
            <div class="option-img" style="background:#e1f5fe;color:#03a9f4;">ğŸ£</div>
            <div class="option-label">è¾›è¾£ç”Ÿå†·æ²¹è…»</div>
            <div class="option-desc">ä¸å¥åº·é€‰æ‹©</div>
          </div>
        </div>
        <div class="module-feedback"></div>
      </div>

      <!-- æ´»åŠ¨ -->
      <div class="section">
        <h2 class="section-title">æ´»åŠ¨<br><small>é€‚é‡è¿åŠ¨å“¦</small></h2>
        <div class="options-grid" data-category="activity">
          <div class="option-card" data-value="è¿åŠ¨äº†">
            <div class="option-img" style="background:#e8f5e8;color:#4caf50;">ğŸ‹ï¸</div>
            <div class="option-label">è¿åŠ¨äº†</div>
            <div class="option-desc">ä¸“ä¸šé”»ç‚¼</div>
          </div>
          <div class="option-card" data-value="æ•£æ­¥äº†">
            <div class="option-img" style="background:#fff8e1;color:#ff9800;">ğŸš¶</div>
            <div class="option-label">æ•£æ­¥äº†</div>
            <div class="option-desc">è½»æ¾æ­¥è¡Œ</div>
          </div>
          <div class="option-card" data-value="æ™’å¤ªé˜³">
            <div class="option-img" style="background:#fff8e1;color:#ff9800;">â˜€ï¸</div>
            <div class="option-label">æ™’å¤ªé˜³</div>
            <div class="option-desc">è¡¥å……ç»´ç”Ÿç´ D</div>
          </div>
          <div class="option-card" data-value="æ‹‰ä¼¸äº†">
            <div class="option-img" style="background:#e3f2fd;color:#2196f3;">ğŸ§˜</div>
            <div class="option-label">æ‹‰ä¼¸äº†</div>
            <div class="option-desc">æŸ”éŸ§æ€§è®­ç»ƒ</div>
          </div>
          <div class="option-card" data-value="è½»åº¦æ´»åŠ¨">
            <div class="option-img" style="background:#e0f7fa;color:#0097a7;">ğŸ§¹</div>
            <div class="option-label">è½»åº¦æ´»åŠ¨</div>
            <div class="option-desc">æ—¥å¸¸åŠ³ä½œ</div>
          </div>
          <div class="option-card" data-value="éœ€è¦ä¼‘æ¯">
            <div class="option-img" style="background:#ffebee;color:#f44336;">ğŸ›‹ï¸</div>
            <div class="option-label">éœ€è¦ä¼‘æ¯</div>
            <div class="option-desc">è¿‡åº¦ç–²åŠ³</div>
          </div>
        </div>
        <div class="module-feedback"></div>
      </div>

      <!-- èº«ä½“æ„Ÿå—ï¼šä¿®æ”¹ - åˆå¹¶è…¹ç—›/è…¹èƒ€ä¸ºè…¹éƒ¨ä¸é€‚ï¼Œå›¾æ ‡æ”¹ä¸ºğŸ¤¢ -->
      <div class="section">
        <h2 class="section-title">èº«ä½“è‡ªæŸ¥<br><small>å…³æ³¨èº«ä½“ç»†å¾®å˜åŒ–</small></h2>
        <div class="options-grid" data-category="body">
          <!-- 1. æ„Ÿè§‰ä¸é”™ -->
          <div class="option-card" data-value="æ„Ÿè§‰ä¸é”™ï¼">
            <div class="option-img" style="background:#e8f5e8;color:#4caf50;">ğŸ˜Š</div>
            <div class="option-label">æ„Ÿè§‰ä¸é”™ï¼</div>
            <div class="option-desc">çŠ¶æ€è‰¯å¥½</div>
          </div>
          <!-- 2. ç–²æƒ«ä¹åŠ› -->
          <div class="option-card" data-value="ç–²æƒ«ä¹åŠ›">
            <div class="option-img" style="background:#fff8e1;color:#ff9800;">ğŸ˜©</div>
            <div class="option-label">ç–²æƒ«ä¹åŠ›</div>
            <div class="option-desc">å…¨èº«æ— åŠ›</div>
          </div>
          <!-- 3. å¤´ç—›å¤´æ™• -->
          <div class="option-card" data-value="å¤´ç—›å¤´æ™•">
            <div class="option-img" style="background:#ffebee;color:#f44336;">ğŸ§ </div>
            <div class="option-label">å¤´ç—›å¤´æ™•</div>
            <div class="option-desc">å‹åŠ›æˆ–ç–²åŠ³</div>
          </div>
          <!-- 4. çœ¼ç›å¹²æ¶© -->
          <div class="option-card" data-value="çœ¼ç›å¹²æ¶©">
            <div class="option-img" style="background:#ffebee;color:#f44336;">ğŸ‘ï¸</div>
            <div class="option-label">çœ¼ç›å¹²æ¶©</div>
            <div class="option-desc">ç”¨çœ¼è¿‡åº¦</div>
          </div>
          <!-- 5. é¼»å¡ä¸é€š -->
          <div class="option-card" data-value="é¼»å¡ä¸é€š">
            <div class="option-img" style="background:#e3f2fd;color:#2196f3;">ğŸ‘ƒ</div>
            <div class="option-label">é¼»å¡ä¸é€š</div>
            <div class="option-desc">å¯èƒ½æ„Ÿå†’</div>
          </div>
          <!-- 6. å’³å—½ä¸é€‚ -->
          <div class="option-card" data-value="å’³å—½ä¸é€‚">
            <div class="option-img" style="background:#fff3e0;color:#ff9800;">ğŸ¤§</div>
            <div class="option-label">å’³å—½ä¸é€‚</div>
            <div class="option-desc">å‘¼å¸é“æ•æ„Ÿ</div>
          </div>
          <!-- 7. èƒ¸é—·æ°”çŸ­ -->
          <div class="option-card" data-value="èƒ¸é—·æ°”çŸ­">
            <div class="option-img" style="background:#ffebee;color:#f44336;">ğŸ«</div>
            <div class="option-label">èƒ¸é—·æ°”çŸ­</div>
            <div class="option-desc">å‘¼å¸ä¸ç•…</div>
          </div>
          <!-- 8. è‚©é¢ˆä¸é€‚ -->
          <div class="option-card" data-value="è‚©é¢ˆä¸é€‚">
            <div class="option-img" style="background:#f3e5f5;color:#9c27b0;">ğŸ’†</div>
            <div class="option-label">è‚©é¢ˆä¸é€‚</div>
            <div class="option-desc">ä¹…åå¯¼è‡´</div>
          </div>
          <!-- 9. è…°èƒŒé…¸ç—› -->
          <div class="option-card" data-value="è…°èƒŒé…¸ç—›">
            <div class="option-img" style="background:#e1f5fe;color:#03a9f4;">ğŸ¦´</div>
            <div class="option-label">è…°èƒŒé…¸ç—›</div>
            <div class="option-desc">å§¿åŠ¿ä¸è‰¯</div>
          </div>
          <!-- 10. è…¹éƒ¨ä¸é€‚ï¼ˆåˆå¹¶åŸè…¹ç—›/è…¹èƒ€ï¼Œå›¾æ ‡æ”¹ä¸ºğŸ¤¢ï¼‰ -->
          <div class="option-card" data-value="è…¹éƒ¨ä¸é€‚">
            <div class="option-img" style="background:#ffebee;color:#f44336;">ğŸ¤¢</div>
            <div class="option-label">è…¹éƒ¨ä¸é€‚</div>
            <div class="option-desc">è…¹ç—›/è…¹èƒ€ç­‰ä¸é€‚</div>
          </div>
          <!-- 11. è…¿éƒ¨æ²‰é‡ -->
          <div class="option-card" data-value="è…¿éƒ¨æ²‰é‡">
            <div class="option-img" style="background:#e8f5e8;color:#4caf50;">ğŸ¦µ</div>
            <div class="option-label">è…¿éƒ¨æ²‰é‡</div>
            <div class="option-desc">å¾ªç¯ä¸ç•…</div>
          </div>
          <!-- 12. å‹åŠ›è¿‡å¤§ -->
          <div class="option-card" data-value="å‹åŠ›è¿‡å¤§">
            <div class="option-img" style="background:#fff8e1;color:#ff9800;">ğŸ˜°</div>
            <div class="option-label">å‹åŠ›è¿‡å¤§</div>
            <div class="option-desc">æƒ…ç»ªç´§å¼ </div>
          </div>
        </div>
        <div class="module-feedback"></div>
      </div>
    </div>

    <!-- ç»Ÿè®¡é¡µ -->
    <div id="stats-page" class="page">
      <div class="tabs">
        <button class="tab-btn active" data-period="today">ä»Šå¤©</button>
        <button class="tab-btn" data-period="yesterday">æ˜¨å¤©</button>
        <button class="tab-btn" data-period="week">æœ¬å‘¨</button>
        <button class="tab-btn" data-period="month">æœ¬æœˆ</button>
        <button class="tab-btn" data-period="all">å…¨éƒ¨è®°å½•</button>
      </div>
      <div id="stats-content"></div>

      <!-- è®¾ç½®å›¾æ ‡ï¼ˆæ›¿ä»£åŸæ¥çš„éšç§è¯´æ˜æ–‡å­—ï¼‰ -->
      <div class="settings-icon" id="privacyLink">âš™ï¸</div>
    </div>

    <div class="nav-buttons">
      <button onclick="switchPage('main')">ä»Šæ—¥æ‰“å¡</button>
      <button class="secondary" onclick="switchPage('stats')">æŸ¥çœ‹ç»Ÿè®¡</button>
    </div>
  </div>

  <!-- éšç§æ¨¡æ€æ¡† -->
  <div class="modal" id="privacyModal">
    <div class="modal-content">
      <h3>å…³äºä½ çš„æ•°æ®</h3>
      <p>æ‰€æœ‰è®°å½•ä»…ä¿å­˜åœ¨ä½ çš„è®¾å¤‡ä¸­ï¼Œ<br>ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚</p>
      <p>å…³é—­æµè§ˆå™¨æˆ–æ¸…é™¤ç¼“å­˜åï¼Œæ•°æ®å°†æ¶ˆå¤±ã€‚</p>
      <!-- æ–°å¢åˆ é™¤æˆåŠŸæç¤º -->
      <div class="delete-success" id="deleteSuccess">âœ… å·²ç»åˆ é™¤äº†æ‰€æœ‰è®°å½•ï¼</div>
      <div class="modal-buttons" id="modalButtons">
        <button class="btn-delete" id="clearDataBtn">ğŸ—‘ï¸ ä¸€é”®åˆ é™¤æ‰€æœ‰è®°å½•</button>
        <button class="btn-cancel" id="closeModal">æˆ‘çŸ¥é“äº†</button>
        <!-- æ–°å¢å®ŒæˆæŒ‰é’®ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <button class="btn-complete" id="completeBtn" style="display: none;">å®Œæˆ</button>
      </div>
    </div>
  </div>

  <script>
    // === å…¨å±€çŠ¶æ€ ===
    const categoryConfig = {
      sleep: { title: 'ç¡çœ æƒ…å†µ' },
      food: { title: 'é¥®é£Ÿæƒ…å†µ' },
      activity: { title: 'æ´»åŠ¨æƒ…å†µ' },
      body: { title: 'èº«ä½“æ„Ÿå—' }
    };

    let currentPeriod = 'today';

    // === é¡µé¢åˆ‡æ¢ ===
    function switchPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(`${page}-page`).classList.add('active');
      if (page === 'stats') renderStats();
    }

    // === å…±æƒ…åé¦ˆæ–‡æ¡ˆåº“ï¼šä¿®æ”¹ - æ›¿æ¢è…¹éƒ¨ä¸é€‚çš„åé¦ˆ ===
    const feedbackMessages = {
      sleep: {
        'ç¡å¾—å¾ˆå¥½': 'ğŸŒ™ èº«ä½“åœ¨ä¿®å¤ï¼ŒçœŸå¥½ã€‚',
        'å¤±çœ äº†': 'å¤œæ·±äººé™æ—¶ï¼Œå…è®¸è‡ªå·±ä¼‘æ¯å°±å¥½ï¼Œä¸å¿…å¼ºæ±‚å…¥ç¡ã€‚\n<small>å¯ä»¥è¯•è¯•æŠŠç¯è°ƒæš—ï¼Œå¬ä¸€æ®µç™½å™ªéŸ³ã€‚</small>',
        'æ—©é†’äº†': 'æ¸…æ™¨é†’æ¥æœ‰ç‚¹æ—©ï¼Ÿæ²¡å…³ç³»ï¼Œé—­çœ¼æ”¾æ¾ä¹Ÿæ˜¯ä¼‘æ¯ã€‚\n<small>æ­¤åˆ»ä¸å¿…çœ‹æ—¶é—´ï¼Œè®©å‘¼å¸æ…¢ä¸‹æ¥ã€‚</small>',
        'ä¸­é€”é†’äº†': 'å¤œé‡Œé†’æ¥å‡ æ¬¡å¾ˆæ­£å¸¸ï¼Œä½ å·²ç»åœ¨åŠªåŠ›ç…§é¡¾è‡ªå·±äº†ã€‚\n<small>ç¿»ä¸ªèº«ï¼Œç»™è‡ªå·±ä¸€ä¸ªæ‹¥æŠ±ã€‚</small>',
        'æ·±ç¡å°‘': 'æµ…ç¡ä¹Ÿæ˜¯ç¡ï¼Œä»Šå¤©å¯ä»¥è¯•è¯•ç¡å‰æ³¡ä¸ªè„šï½\n<small>çƒ­æ°´æ³¡è„š10åˆ†é’Ÿï¼Œä¼šèˆ’æœå¾ˆå¤šã€‚</small>',
        'åšå™©æ¢¦äº†': 'æ¢¦å¢ƒå“åˆ°ä½ äº†å—ï¼Ÿç°åœ¨æ˜¯å®‰å…¨çš„ï¼Œæ·±å‘¼å¸ä¸€ä¸‹å§ã€‚\n<small>å–ä¸€å°å£æ¸©æ°´ï¼Œå›åˆ°å½“ä¸‹ã€‚</small>'
      },
      food: {
        'åƒå¾—æ­£å¥½': 'ğŸš æ¯ä¸€å£éƒ½å€¼å¾—å¥½å¥½å“å‘³ã€‚',
        'æ²¡æŒ‰æ—¶åƒ': 'å¿™çš„æ—¶å€™ä¹Ÿè¦è®°å¾—å–‚é¥±è‡ªå·±å‘€ã€‚\n<small>å“ªæ€•åªåƒå‡ å£é¥¼å¹²ï¼Œä¹Ÿæ¯”ç©ºç€å¥½ã€‚</small>',
        'æ²¡åƒé¥±': 'ä¸‹ä¸€é¤ï¼Œæ…¢æ…¢åƒï¼Œåƒåˆ°æ»¡è¶³ä¸ºæ­¢ã€‚\n<small>èƒƒè¯´å®ƒè¿˜æƒ³å†åƒä¸€ç‚¹ï¼Œé‚£å°±å†åƒä¸€ç‚¹ã€‚</small>',
        'åƒæ’‘äº†': 'èƒƒè¯´å®ƒæœ‰ç‚¹ç´¯å•¦ï¼Œä¸‹æ¬¡ä¸ƒåˆ†é¥±åˆšåˆšå¥½ã€‚\n<small>ç«™èµ·æ¥èµ°ä¸¤æ­¥ï¼Œå¸®åŠ©æ¶ˆåŒ–ã€‚</small>',
        'ç”Ÿå†·æ²¹è…»': 'å¶å°”æ”¾çºµæ²¡å…³ç³»ï¼Œæ˜å¤©å¯ä»¥æ¸…æ·¡ä¸€ç‚¹ï½\n<small>ç…®ç‚¹å°ç±³ç²¥ï¼Œæš–æš–èƒƒå§ã€‚</small>'
      },
      activity: {
        'è¿åŠ¨äº†': 'ğŸ’ª èº«ä½“æ„Ÿè°¢ä½ çš„ç”¨å¿ƒé™ªä¼´ï¼',
        'æ•£æ­¥äº†': 'ğŸš¶â€â™€ï¸ è„šæ­¥è™½è½»ï¼Œå´æ˜¯å¯¹ç”Ÿæ´»æ¸©æŸ”çš„å›åº”ã€‚',
        'æ™’å¤ªé˜³': 'â˜€ï¸ é˜³å…‰æ˜¯æœ€å¥½çš„ç»´ç”Ÿç´ ï¼Œä½ åšå¾—å¾ˆå¥½ï¼',
        'æ‹‰ä¼¸äº†': 'ğŸ§˜ è‚Œè‚‰æ¾ä¸‹æ¥äº†ï¼Œå¿ƒä¹Ÿä¼šè·Ÿç€æ”¾æ¾ä¸€ç‚¹ã€‚\n<small>ç°åœ¨å¯ä»¥åšä¸€æ¬¡æ·±å‘¼å¸ï¼Œæ„Ÿå—èº«ä½“çš„èˆ’å±•ã€‚</small>',
        'è½»åº¦æ´»åŠ¨': 'æ—¥å¸¸çš„å°åŠ¨ä½œï¼Œä¹Ÿæ˜¯åœ¨å¥½å¥½æ´»ç€å‘¢ã€‚\n<small>ç»™è‡ªå·±ä¸€ä¸ªå¾®ç¬‘ï¼Œä½ å¾ˆæ£’ã€‚</small>',
        'éœ€è¦ä¼‘æ¯': 'åœä¸‹æ¥ä¸æ˜¯å·æ‡’ï¼Œæ˜¯èº«ä½“åœ¨è¯·æ±‚å…³æ€€ã€‚\n<small>ç°åœ¨é—­çœ¼ï¼Œåš3æ¬¡æ·±å‘¼å¸ï¼Œè®©èº«ä½“æ”¾æ¾ã€‚</small>'
      },
      body: {
        'æ„Ÿè§‰ä¸é”™ï¼': 'ğŸ˜Š ä»Šå¤©çš„çŠ¶æ€çœŸæ£’ï¼Œç»§ç»­ä¿æŒè¿™ä»½è§‰å¯Ÿå§ï¼',
        'ç–²æƒ«ä¹åŠ›': 'èº«ä½“åœ¨æé†’ä½ éœ€è¦ä¼‘æ¯å•¦ï¼Œä¸ç”¨ç¡¬æ’‘ã€‚\n<small>æ‰¾ä¸ªèˆ’æœçš„å§¿åŠ¿åä¸‹æ¥ï¼Œé—­çœ¼ä¼‘æ¯5åˆ†é’Ÿã€‚</small>',
        'å¤´ç—›å¤´æ™•': 'ğŸ§  å¤´æ™•çš„æ—¶å€™ï¼Œæ‰¾ä¸ªå®‰é™è§’è½æ·±å‘¼å¸å‡ æ¬¡ã€‚\n<small>ç°åœ¨åœä¸‹æ¥å–å£æ°´ï¼Œè®©å¤§è„‘ä¼‘æ¯ä¸€ä¸‹ã€‚</small>',
        'çœ¼ç›å¹²æ¶©': 'ğŸ‘ï¸ çœ¼ç›ç´¯äº†ï¼Œé—­ä¸€ä¼šå„¿ï¼Œè®©å®ƒä¼‘æ¯ä¸€ä¸‹ã€‚\n<small>ç°åœ¨çœ‹çœ‹è¿œå¤„ï¼Œçœ¨çœ¨çœ¼ã€‚</small>',
        'é¼»å¡ä¸é€š': 'ğŸ‘ƒ å‘¼å¸ä¸ç•…çš„æ—¶å€™ï¼Œè¯•è¯•æ¸©æ°´è’¸æ°”ï½\n<small>ç”¨çƒ­æ¯›å·¾æ•·ä¸€ä¸‹é¼»å­ï¼Œä¼šèˆ’æœäº›ã€‚</small>',
        'å’³å—½ä¸é€‚': 'ğŸ¤§ å–‰å’™ä¸èˆ’æœï¼Ÿå°å£å–ç‚¹æ¸©æ°´å§ã€‚\n<small>ç°åœ¨å–ä¸€å£æ¸©æ°´ï¼Œæ¶¦æ¶¦å—“å­ã€‚</small>',
        'èƒ¸é—·æ°”çŸ­': 'å‘¼å¸æœ‰ç‚¹è´¹åŠ›æ˜¯å—ï¼Ÿæ…¢æ…¢è°ƒæ•´èŠ‚å¥å°±å¥½ã€‚\n<small>ç”¨é¼»å­å¸æ°”4ç§’ï¼Œå˜´å·´å‘¼æ°”6ç§’ï¼Œé‡å¤3æ¬¡ã€‚</small>',
        'è‚©é¢ˆä¸é€‚': 'ğŸ’† è‚©è†€æ‰›äº†å¤ªå¤šï¼Œè½»è½»è½¬ä¸€è½¬ï¼Œé‡Šæ”¾ä¸€ç‚¹å‹åŠ›ã€‚\n<small>ç°åœ¨æŠŠè‚©è†€è€¸èµ·ï¼Œç„¶åæ”¾æ¾ï¼Œé‡å¤3æ¬¡ã€‚</small>',
        'è…°èƒŒé…¸ç—›': 'ğŸ¦´ èƒŒæœ‰ç‚¹ç´¯äº†å§ï¼Ÿé ä¸€é ï¼Œåˆ«ç¡¬æ’‘ã€‚\n<small>ç°åœ¨èµ·èº«ï¼ŒåŒæ‰‹æ‰¶è…°ï¼Œè½»è½»å‘åä»°ä¸€ä¸‹ã€‚</small>',
        // ä¿®æ”¹ï¼šæ–°å¢è…¹éƒ¨ä¸é€‚åé¦ˆï¼ˆåˆå¹¶åŸè…¹ç—›/è…¹èƒ€ï¼‰
        'è…¹éƒ¨ä¸é€‚': 'è…¹éƒ¨æœ‰ç‚¹ä¸èˆ’æœï¼Œå…ˆè®©èº«ä½“æ”¾æ¾ä¸‹æ¥ã€‚\n<small>æ³¨æ„é¥®é£Ÿæ¸…æ·¡ï¼Œæ…¢æ…¢èµ°ä¸€èµ°å¸®åŠ©æ¶ˆåŒ–ã€‚</small>',
        'è…¿éƒ¨æ²‰é‡': 'ğŸ¦µ è…¿è¯´å®ƒæƒ³æ­‡ä¸€æ­‡ï¼ŒæŠ¬é«˜ä¸€ä¸‹ä¼šèˆ’æœäº›ã€‚\n<small>ç°åœ¨åä¸‹ï¼ŒæŠŠè…¿æŠ¬èµ·æ¥ï¼Œè®©è¡€æ¶²å›æµã€‚</small>',
        'å‹åŠ›è¿‡å¤§': 'ğŸ˜° å‹åŠ›å¤§æ—¶ï¼Œå…è®¸è‡ªå·±â€œä»€ä¹ˆéƒ½ä¸åšâ€ä¸€ä¼šå„¿ã€‚\n<small>ç°åœ¨é—­çœ¼ï¼Œæ·±å‘¼å¸ï¼Œä»€ä¹ˆéƒ½ä¸æƒ³ã€‚</small>'
      }
    };

    // === å¤šé€‰ + æ¨¡å—å†…åé¦ˆæ¨ªæ¡ï¼ˆå«å¾®è¡ŒåŠ¨ï¼‰===
    document.querySelectorAll('.option-card').forEach(card => {
      card.addEventListener('click', function () {
        this.classList.toggle('selected');
        const category = this.closest('.options-grid').dataset.category;
        const value = this.dataset.value;
        const today = new Date().toISOString().split('T')[0];

        const selectedValues = Array.from(
          this.parentElement.querySelectorAll('.option-card.selected')
        ).map(c => c.dataset.value);

        localStorage.setItem(`haohao_${category}_${today}`, JSON.stringify(selectedValues));

        // === æ‰¾åˆ°å½“å‰æ¨¡å—çš„åé¦ˆæ¨ªæ¡ ===
        const section = this.closest('.section');
        const feedbackEl = section.querySelector('.module-feedback');

        const msg = feedbackMessages[category]?.[value] || 'è°¢è°¢ä½ å…³æ³¨è‡ªå·±çš„æ„Ÿå—ã€‚';
        feedbackEl.innerHTML = msg.replace('\n<small>', '<small>').replace('</small>', '</small>');

        // æ˜¾ç¤º + åŠ¨ç”»
        feedbackEl.classList.remove('show');
        void feedbackEl.offsetWidth; // è§¦å‘é‡æ’
        feedbackEl.classList.add('show');

        // 3ç§’åæ·¡å‡º
        clearTimeout(feedbackEl.timeoutId);
        feedbackEl.timeoutId = setTimeout(() => {
          feedbackEl.classList.remove('show');
        }, 3000);
      });
    });

    // ç«æ˜Ÿå›¾æ ‡ä¸æ–‡å­—æ˜¾ç¤ºé€»è¾‘
    const marsIcon = document.getElementById('mars-icon');
    const subtitleText = document.getElementById('subtitle-text');

    const isMarsLit = localStorage.getItem('mars_lit') === 'true';
    const isTextVisible = localStorage.getItem('subtitle_text_visible') === 'true';

    if (isMarsLit) {
      marsIcon.classList.add('lit');
    }
    if (isTextVisible) {
      subtitleText.classList.add('visible');
    }

    marsIcon.addEventListener('click', () => {
      const isCurrentlyLit = marsIcon.classList.contains('lit');
      const isCurrentlyVisible = subtitleText.classList.contains('visible');

      if (isCurrentlyLit && isCurrentlyVisible) {
        marsIcon.classList.remove('lit');
        subtitleText.classList.remove('visible');
        localStorage.setItem('mars_lit', 'false');
        localStorage.setItem('subtitle_text_visible', 'false');
      } else {
        marsIcon.classList.add('lit');
        subtitleText.classList.add('visible');
        localStorage.setItem('mars_lit', 'true');
        localStorage.setItem('subtitle_text_visible', 'true');
      }
    });

    // åŠ è½½ä»Šæ—¥å·²é€‰ï¼ˆå¤šé€‰ï¼‰
    window.onload = () => {
      const today = new Date().toISOString().split('T')[0];
      ['sleep', 'food', 'activity', 'body'].forEach(cat => {
        const saved = localStorage.getItem(`haohao_${cat}_${today}`);
        if (saved) {
          try {
            const values = JSON.parse(saved);
            if (Array.isArray(values)) {
              values.forEach(val => {
                const card = [...document.querySelectorAll(`[data-category="${cat}"] .option-card`)]
                  .find(c => c.dataset.value === val);
                if (card) card.classList.add('selected');
              });
            }
          } catch (e) {
            console.warn('Failed to parse saved data for', cat, e);
          }
        }
      });
    };

    // æ—¶é—´åˆ‡æ¢ & ç»Ÿè®¡é¡µé€»è¾‘
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentPeriod = btn.dataset.period;
        renderStats();
      });
    });

    // === éšç§æ¨¡æ€æ¡† ===
    const privacyLink = document.getElementById('privacyLink');
    const privacyModal = document.getElementById('privacyModal');
    const closeModal = document.getElementById('closeModal');
    const clearDataBtn = document.getElementById('clearDataBtn');
    const deleteSuccess = document.getElementById('deleteSuccess');
    const completeBtn = document.getElementById('completeBtn');
    const modalButtons = document.getElementById('modalButtons');

    privacyLink.addEventListener('click', () => {
      privacyModal.classList.add('show');
    });

    closeModal.addEventListener('click', () => {
      privacyModal.classList.remove('show');
    });

    // ä¿®æ”¹åˆ é™¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    clearDataBtn.addEventListener('click', () => {
      // ç›´æ¥åˆ é™¤æ‰€æœ‰è®°å½•ï¼Œä¸å†å¼¹å‡ºç¡®è®¤æ¡†
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith('haohao_')) {
          localStorage.removeItem(key);
        }
      });
      
      // æ˜¾ç¤ºåˆ é™¤æˆåŠŸæç¤º
      deleteSuccess.style.display = 'block';
      
      // éšè—åŸæœ‰æŒ‰é’®ï¼Œæ˜¾ç¤ºå®ŒæˆæŒ‰é’®
      clearDataBtn.style.display = 'none';
      closeModal.style.display = 'none';
      completeBtn.style.display = 'inline-block';
    });

    // å®ŒæˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
    completeBtn.addEventListener('click', () => {
      privacyModal.classList.remove('show');
      // åˆ·æ–°é¡µé¢æ¸…é™¤å·²é€‰çŠ¶æ€
      location.reload();
    });

    function getDateRange(period) {
      const now = new Date();
      const dates = [];
      
      if (period === 'today') {
        dates.push(formatDate(now));
      } else if (period === 'yesterday') {
        const yest = new Date(now);
        yest.setDate(now.getDate() - 1);
        dates.push(formatDate(yest));
      } else if (period === 'week') {
        for (let i = 6; i >= 0; i--) {
          const d = new Date(now);
          d.setDate(now.getDate() - i);
          dates.push(formatDate(d));
        }
      } else if (period === 'month') {
        // ä¿®å¤ï¼šæ­£ç¡®è·å–æœ¬æœˆæ‰€æœ‰æ—¥æœŸï¼ˆä»1å·åˆ°æœ€åä¸€å¤©ï¼‰
        const year = now.getFullYear();
        const month = now.getMonth();
        // è·å–å½“æœˆæœ€åä¸€å¤©
        const lastDay = new Date(year, month + 1, 0).getDate();
        // ç”Ÿæˆå½“æœˆ1å·åˆ°æœ€åä¸€å¤©çš„æ‰€æœ‰æ—¥æœŸ
        for (let day = 1; day <= lastDay; day++) {
          const d = new Date(year, month, day);
          dates.push(formatDate(d));
        }
      } else if (period === 'all') {
        return [];
      }
      return dates;
    }

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    function renderStats() {
      const container = document.getElementById('stats-content');
      container.innerHTML = '';

      if (currentPeriod === 'all') {
        renderCountStats(container);
      } else {
        renderDateStats(container);
      }
    }

    function renderDateStats(container) {
      const dates = getDateRange(currentPeriod);
      container.innerHTML = '';

      const allSelected = [];
      let hasData = false;

      dates.forEach(date => {
        ['sleep', 'food', 'activity', 'body'].forEach(cat => {
          const saved = localStorage.getItem(`haohao_${cat}_${date}`);
          if (saved) {
            try {
              const values = JSON.parse(saved);
              if (Array.isArray(values) && values.length > 0) {
                hasData = true;
                values.forEach(v => allSelected.push({ date, category: cat, value: v }));
              }
            } catch (e) {
              console.warn('Failed to parse stats for', cat, date, e);
            }
          }
        });
      });

      if (!hasData) {
        container.innerHTML = '<div class="no-data">æš‚æ— è®°å½•</div>';
        return;
      }

      // åªæ¸²æŸ“æœ‰æ•°æ®çš„æ—¥æœŸ
      const datesWithData = new Set(allSelected.map(r => r.date));
      const sortedDates = Array.from(datesWithData).sort((a, b) => new Date(b) - new Date(a));

      // æ ‡é¢˜æ”¹ä¸ºä¸­æ€§æè¿°
      const title = document.createElement('h3');
      title.textContent = 'ä½ åœ¨è¿™äº›æ—¥å­é‡Œç…§é¡¾äº†è‡ªå·±';
      title.style.textAlign = 'center';
      title.style.marginBottom = '20px';
      title.style.color = '#555';
      container.appendChild(title);

      sortedDates.forEach(date => {
        const dateSection = document.createElement('div');
        dateSection.style.marginBottom = '20px';
        const dateHeader = document.createElement('h3');
        dateHeader.textContent = date;
        dateHeader.style.marginBottom = '12px';
        dateHeader.style.color = '#555';
        dateSection.appendChild(dateHeader);

        ['sleep', 'food', 'activity', 'body'].forEach(cat => {
          const saved = localStorage.getItem(`haohao_${cat}_${date}`);
          if (saved) {
            try {
              const values = JSON.parse(saved);
              if (Array.isArray(values) && values.length > 0) {
                const item = document.createElement('div');
                item.className = 'stat-item';
                item.innerHTML = `<strong>${categoryConfig[cat].title}ï¼š</strong> ${values.join('ã€')}`;
                dateSection.appendChild(item);
              }
            } catch (e) {
              console.warn('Failed to parse stats for', cat, date, e);
            }
          }
        });

        container.appendChild(dateSection);
      });

      const recentDays = currentPeriod === 'today' ? 1 :
                        currentPeriod === 'yesterday' ? 1 :
                        currentPeriod === 'week' ? 7 :
                        currentPeriod === 'month' ? 30 : 7;

      const now = new Date();
      const cutoffDate = new Date(now);
      cutoffDate.setDate(now.getDate() - recentDays + 1);
      const cutoffStr = formatDate(cutoffDate);

      const recentRecords = allSelected.filter(r => r.date >= cutoffStr);

      if (recentRecords.length > 0) {
        const bodyCount = {};
        recentRecords
          .filter(r => r.category === 'body' && r.value !== 'æ„Ÿè§‰ä¸é”™ï¼')
          .forEach(r => {
            bodyCount[r.value] = (bodyCount[r.value] || 0) + 1;
          });

        let frequentBodyIssue = null;
        for (const [issue, count] of Object.entries(bodyCount)) {
          if (count >= 2 && !frequentBodyIssue) {
            frequentBodyIssue = issue;
            break;
          }
        }

        const sleepIssues = ['å¤±çœ äº†', 'æ—©é†’äº†', 'ä¸­é€”é†’äº†', 'åšå™©æ¢¦äº†', 'æ·±ç¡å°‘'];
        const sleepCount = {};
        recentRecords
          .filter(r => r.category === 'sleep' && sleepIssues.includes(r.value))
          .forEach(r => {
            sleepCount[r.value] = (sleepCount[r.value] || 0) + 1;
          });

        let frequentSleepIssue = null;
        for (const [issue, count] of Object.entries(sleepCount)) {
          if (count >= 2 && !frequentSleepIssue) {
            frequentSleepIssue = issue;
            break;
          }
        }

        let tipText = '';
        if (frequentBodyIssue) {
          const tips = {
            'è‚©é¢ˆä¸é€‚': 'è®°å¾—æ¯éš”ä¸€å°æ—¶è½»è½»è½¬ä¸€è½¬è„–å­ï¼Œæˆ–åšä¸ªç®€å•çš„æ‹‰ä¼¸ï½',
            'å¤´ç—›å¤´æ™•': 'å¯ä»¥è¯•è¯•é—­çœ¼æ·±å‘¼å¸å‡ æ¬¡ï¼Œè®©å¤§è„‘ä¼‘æ¯ä¸€ä¸‹ã€‚',
            'çœ¼ç›å¹²æ¶©': 'çœ‹çœ‹è¿œå¤„çš„ç»¿æ¤ï¼Œç»™çœ¼ç›å‡ åˆ†é’Ÿæ”¾æ¾æ—¶é—´å§ã€‚',
            'å‹åŠ›è¿‡å¤§': 'å…è®¸è‡ªå·±æš‚åœä¸€ä¸‹ï¼Œä»€ä¹ˆéƒ½ä¸åšä¹Ÿæ˜¯åœ¨ç…§é¡¾è‡ªå·±ã€‚',
            'ç–²æƒ«ä¹åŠ›': 'æœ€è¿‘å®¹æ˜“ç´¯ï¼Œè®°å¾—ç´¯äº†å°±æ­‡ä¼šå„¿ï¼Œä¸ç”¨è¿½æ±‚å®Œç¾ã€‚',
            'èƒ¸é—·æ°”çŸ­': 'å‘¼å¸ä¸å¤ªé¡ºç•…æ—¶ï¼Œè¯•è¯•æ”¾æ…¢èŠ‚å¥ï¼Œå¤šåšå‡ æ¬¡æ·±å‘¼å¸ã€‚',
            // ä¿®æ”¹ï¼šæ–°å¢è…¹éƒ¨ä¸é€‚æç¤ºï¼ˆåˆå¹¶åŸè…¹ç—›/è…¹èƒ€ï¼‰
            'è…¹éƒ¨ä¸é€‚': 'è…¹éƒ¨å¶å°”ä¸é€‚ï¼Œæ³¨æ„é¥®é£Ÿæ¸…æ·¡ï¼Œé¥­åæ…¢æ…¢èµ°ä¸€èµ°å¸®åŠ©æ¶ˆåŒ–ã€‚',
          };
          const defaultTip = 'è¦è®°å¾—å¤šå…³æ³¨ä¸€ä¸‹èº«ä½“çš„æ„Ÿå—å“¦ã€‚';
          tipText += `ä½ æœ€è¿‘å¸¸æåˆ°â€œ${frequentBodyIssue}â€ï¼Œ${tips[frequentBodyIssue] || defaultTip}`;
        } else if (frequentSleepIssue) {
          const tips = {
            'å¤±çœ äº†': 'ç¡å‰å¯ä»¥è¯•è¯•å¬ç‚¹è½»éŸ³ä¹ï¼Œæˆ–å†™å‡ è¡Œæ—¥è®°æ¸…ç©ºæ€ç»ªã€‚',
            'æ—©é†’äº†': 'é†’æ¥åä¸ç”¨æ€¥ç€èµ·åºŠï¼Œé—­çœ¼æ”¾æ¾ä¹Ÿæ˜¯ä¼‘æ¯ã€‚',
            'ä¸­é€”é†’äº†': 'å¤œé‡Œé†’æ¥å¾ˆæ­£å¸¸ï¼Œæ·±å‘¼å¸å‡ æ¬¡ï¼Œæ…¢æ…¢å›åˆ°ç¡çœ ä¸­ã€‚'
          };
          const defaultTip = 'ç¡çœ åœ¨æ…¢æ…¢è°ƒæ•´ä¸­ï¼Œç»™è‡ªå·±å¤šä¸€ç‚¹è€å¿ƒã€‚';
          tipText += `ä½ æœ€è¿‘å¸¸æåˆ°â€œ${frequentSleepIssue}â€ï¼Œ${tips[frequentSleepIssue] || defaultTip}`;
        } else if (recentRecords.some(r => r.category === 'body' && r.value === 'æ„Ÿè§‰ä¸é”™ï¼')) {
          tipText = 'æœ€è¿‘èº«ä½“çŠ¶æ€ä¸é”™ï¼Œç»§ç»­ä¿æŒè¿™ä»½è§‰å¯Ÿå’Œæ¸©æŸ”å§ï¼';
        }

        if (tipText) {
          const tipEl = document.createElement('div');
          tipEl.style.marginTop = '24px';
          tipEl.style.padding = '12px';
          tipEl.style.backgroundColor = '#e8f5e9';
          tipEl.style.borderRadius = '12px';
          tipEl.style.color = '#2e7d32';
          tipEl.style.fontSize = '0.95rem';
          tipEl.style.borderLeft = '3px solid #4caf50';
          tipEl.textContent = tipText;
          container.appendChild(tipEl);
        }
      }
    }

    function renderCountStats(container) {
      const counter = {};

      const allOptions = {
        sleep: ['ç¡å¾—å¾ˆå¥½', 'å¤±çœ äº†', 'æ—©é†’äº†', 'ä¸­é€”é†’äº†', 'åšå™©æ¢¦äº†', 'æ·±ç¡å°‘'],
        food: ['åƒå¾—æ­£å¥½', 'æ²¡æŒ‰æ—¶åƒ', 'æ²¡åƒé¥±', 'åƒæ’‘äº†', 'è¾›è¾£ç”Ÿå†·æ²¹è…»'],
        activity: ['è¿åŠ¨äº†', 'æ•£æ­¥äº†', 'æ‹‰ä¼¸äº†', 'è½»åº¦æ´»åŠ¨', 'éœ€è¦ä¼‘æ¯', 'æ™’å¤ªé˜³'],
        // ä¿®æ”¹ï¼šbodyæ•°ç»„ä¸­æ›¿æ¢è…¹éƒ¨ä¸é€‚ï¼ˆåˆ é™¤è…¹ç—›/è…¹èƒ€ï¼Œæ–°å¢è…¹éƒ¨ä¸é€‚ï¼‰
        body: ['æ„Ÿè§‰ä¸é”™ï¼', 'ç–²æƒ«ä¹åŠ›', 'å¤´ç—›å¤´æ™•', 'çœ¼ç›å¹²æ¶©', 'é¼»å¡ä¸é€š', 'å’³å—½ä¸é€‚', 'èƒ¸é—·æ°”çŸ­', 'è‚©é¢ˆä¸é€‚', 'è…°èƒŒé…¸ç—›', 'è…¹éƒ¨ä¸é€‚', 'è…¿éƒ¨æ²‰é‡', 'å‹åŠ›è¿‡å¤§']
      };

      Object.keys(allOptions).forEach(cat => {
        allOptions[cat].forEach(opt => {
          counter[opt] = 0;
        });
      });

      const dates = getAllDates();
      dates.forEach(date => {
        ['sleep', 'food', 'activity', 'body'].forEach(cat => {
          const key = `haohao_${cat}_${date}`;
          const saved = localStorage.getItem(key);
          if (saved) {
            try {
              const values = JSON.parse(saved);
              if (Array.isArray(values)) {
                values.forEach(val => {
                  if (counter.hasOwnProperty(val)) {
                    counter[val]++;
                  } else {
                    counter[val] = (counter[val] || 0) + 1;
                  }
                });
              }
            } catch (e) {
              console.warn('Parse error:', key, e);
            }
          }
        });
      });

      const trendData = calculateTrends(dates, allOptions);

      let hasData = false;
      Object.entries(categoryConfig).forEach(([cat, config]) => {
        const items = allOptions[cat].map(opt => {
          const count = counter[opt] || 0;
          let trend = 'â¡ï¸'; // é»˜è®¤æ— è¶‹åŠ¿
          if (trendData[opt] !== undefined) {
            if (trendData[opt] > 0) trend = 'ğŸŒ±'; // åªç”¨ä¸€ä¸ªç¬¦å·è¡¨ç¤ºå˜åŒ–
            else if (trendData[opt] < 0) trend = 'ğŸŒ±';
          }
          return { option: opt, count: count, trend: trend };
        }).filter(item => item.count > 0).sort((a, b) => b.count - a.count);

        if (items.length > 0) {
          hasData = true;
          const section = document.createElement('div');
          section.style.marginBottom = '24px';

          const title = document.createElement('h3');
          title.textContent = config.title;
          title.style.marginBottom = '12px';
          title.style.color = '#555';
          section.appendChild(title);

          items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'stat-item counts';
            div.innerHTML = `<span><strong>${item.option}</strong>ï¼š${item.count} æ¬¡</span><span class="stat-trend">${item.trend}</span>`;
            section.appendChild(div);
          });

          container.appendChild(section);
        }
      });

      if (!hasData) {
        container.innerHTML = '<div class="no-data">æš‚æ— æ‰“å¡è®°å½•</div>';
      }
    }

    function getAllDates() {
      const dates = new Set();
      for (let key in localStorage) {
        if (key.startsWith('haohao_')) {
          const parts = key.split('_');
          if (parts.length >= 3) {
            const date = parts.slice(2).join('-');
            if (/^\d{4}-\d{2}-\d{2}$/.test(date)) {
              dates.add(date);
            }
          }
        }
      }
      return Array.from(dates).sort((a, b) => new Date(a) - new Date(b));
    }

    function calculateTrends(dates, allOptions) {
      const now = new Date();
      const oneWeekAgo = new Date(now);
      oneWeekAgo.setDate(now.getDate() - 7);
      const twoWeeksAgo = new Date(now);
      twoWeeksAgo.setDate(now.getDate() - 14);

      const recentCounter = {};
      const previousCounter = {};

      Object.keys(allOptions).forEach(cat => {
        allOptions[cat].forEach(opt => {
          recentCounter[opt] = 0;
          previousCounter[opt] = 0;
        });
      });

      dates.forEach(date => {
        const dateObj = new Date(date);
        let targetCounter = null;

        if (dateObj >= oneWeekAgo) {
          targetCounter = recentCounter;
        } else if (dateObj >= twoWeeksAgo) {
          targetCounter = previousCounter;
        }

        if (targetCounter) {
          ['sleep', 'food', 'activity', 'body'].forEach(cat => {
            const key = `haohao_${cat}_${date}`;
            const saved = localStorage.getItem(key);
            if (saved) {
              try {
                const values = JSON.parse(saved);
                if (Array.isArray(values)) {
                  values.forEach(val => {
                    if (targetCounter.hasOwnProperty(val)) {
                      targetCounter[val]++;
                    }
                  });
                }
              } catch (e) {
                console.warn('Parse error for trend calc:', key, e);
              }
            }
          });
        }
      });

      const trendMap = {};
      Object.keys(allOptions).forEach(cat => {
        allOptions[cat].forEach(opt => {
          const recent = recentCounter[opt] || 0;
          const previous = previousCounter[opt] || 0;
          trendMap[opt] = recent - previous;
        });
      });

      return trendMap;
    }
  </script>
</body>
</html>
