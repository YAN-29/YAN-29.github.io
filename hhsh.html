<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¥½å¥½ç”Ÿæ´»</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans SC', sans-serif;
      background: #f9f7f2;
      color: #333;
      line-height: 1.6;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin: 20px 0 10px;
      color: #5a5a5a;
    }

    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 20px;
      font-size: 0.95rem;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
    }

    .subtitle-text {
      margin-right: 6px; /* ä¸å›¾æ ‡ä¿æŒé—´è· */
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .subtitle-text.visible {
      opacity: 1;
    }

    .mars {
      font-size: 1.2rem;
      cursor: pointer;
      color: #bbb;
      transition: color 0.3s, text-shadow 0.3s;
    }

    .mars.lit {
      color: #e91e63;
      text-shadow: 0 0 8px rgba(233, 30, 99, 0.5);
    }

    .tip {
      background: #e8f5e9;
      padding: 14px;
      border-radius: 12px;
      margin: 20px auto;
      max-width: 600px;
      font-size: 0.95rem;
      color: #2e7d32;
      text-align: center;
      border-left: 3px solid #4caf50;
      display: none; /* éšè—æç¤ºæ¡† */
    }

    .section {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .section-title {
      font-size: 1.2rem;
      margin-bottom: 16px;
      color: #444;
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr); /* å¼ºåˆ¶ 3 åˆ— */
      gap: 12px;
    }

    .option-card {
      border: 2px solid #eee;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .option-card:hover {
      border-color: #bbdefb;
    }

    .option-card.selected {
      border-color: #2196f3;
      background-color: #e3f2fd;
    }

    .option-img {
      width: 100%;
      height: 80px;
      object-fit: cover;
      background: #f5f5f5;
    }

    .option-label {
      padding: 8px 4px;
      font-size: 0.95rem;
      font-weight: 500;
    }

    .option-desc {
      font-size: 0.8rem;
      color: #757575;
      padding: 0 4px 8px;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    .tab-btn {
      padding: 8px 16px;
      background: #eee;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .tab-btn.active {
      background: #2196f3;
      color: white;
    }

    .stat-item {
      padding: 12px 0;
      border-bottom: 1px dashed #eee;
      display: flex;
      justify-content: space-between;
      align-items: center; /* ä½¿å†…å®¹å‚ç›´å±…ä¸­ */
    }

    .stat-item.counts { /* ç”¨äºæ¬¡æ•°ç»Ÿè®¡çš„æ ·å¼ */
      justify-content: space-between;
    }

    .stat-trend { /* è¶‹åŠ¿å›¾æ ‡æ ·å¼ */
      font-size: 1.1rem;
      margin-left: 8px;
    }

    .no-data {
      text-align: center;
      color: #999;
      padding: 20px;
      font-style: italic;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .nav-buttons {
      text-align: center;
      margin-top: 20px;
    }

    .nav-buttons button {
      padding: 10px 20px;
      margin: 0 8px;
      background: #2196f3;
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 1rem;
    }

    .nav-buttons button.secondary {
      background: #9e9e9e;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>å¥½å¥½ç”Ÿæ´»</h1>
    <p class="subtitle">
      <span id="subtitle-text" class="subtitle-text">ä¸€èµ·æ´»ç€</span>
      <span id="mars-icon" class="mars">ğŸŒ•</span>
    </p>

    <!-- <div class="tip"> -->
    <!-- "åƒé¥­çš„æ—¶å€™ä¸“æ³¨æ„Ÿå—æ¯ä¸€å£çš„å‘³é“ï¼Œç»†åš¼æ…¢å’½ä¸ä»…æœ‰åŠ©äºæ¶ˆåŒ–ï¼Œè¿˜èƒ½è®©æˆ‘ä»¬æ›´å¥½åœ°äº«å—ç¾é£Ÿå¸¦æ¥çš„å¿«ä¹ã€‚" -->
    <!-- </div> -->

    <!-- æ‰“å¡é¡µ -->
    <div id="main-page" class="page active">
      <!-- ç¡çœ  -->
      <div class="section">
        <div class="section-title">ç¡çœ <br><small style="font-size:0.8rem;color:#757575;">è®°å¾—åä¸€ç‚¹å‰å…¥ç¡å“¦</small></div>
        <div class="options-grid" data-category="sleep">
          <div class="option-card" data-value="ç¡å¾—å¾ˆå¥½">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cDovL3ZlZXIwNS5jZnAuY24vY3JlYXRpdmUvdmNnL3ZlZXIvMTYwMHdhdGVyL3ZlZXItMzM2MjEzMzQxLmpwZw==&sign=yx:MAC0rKpUOp1XPtFBoo_HTaO7_zE=&tv=400_400" alt="ç¡å¾—å¾ˆå¥½">
            <div class="option-label">ç¡å¾—å¾ˆå¥½</div>
            <div class="option-desc">ä¸€è§‰åˆ°å¤©äº®</div>
          </div>
          <div class="option-card" data-value="å¤±çœ äº†">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cDovL3Bob3RvLXN0YXRpYy1hcGkuZm90b21vcmUuY29tL2NyZWF0aXZlL3ZjZy92ZWVyL25vd2FydGVyODAwL25ldy9WQ0c0MU40NzA3MTIxMDIuanBn&sign=yx:0uNX5tX1D8cToT9vbIlulQyuioI=&tv=400_400" alt="å¤±çœ äº†">
            <div class="option-label">å¤±çœ äº†</div>
            <div class="option-desc">éš¾ä»¥å…¥çœ </div>
          </div>
          <div class="option-card" data-value="æ—©é†’äº†">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cHM6Ly9pbWcuZG9uZ2xpcGluLmNvbS9waWNmaWxlcy9wLzEwNC8xMDQ3MjEvMTY4NzMzMzMwNTkxODQyNy5qcGc=&sign=yx:aQdbadIJ5z0vgm4oc-CLRh2mPec=&tv=400_400" alt="æ—©é†’äº†">
            <div class="option-label">æ—©é†’äº†</div>
            <div class="option-desc">é†’å¾—è¿‡æ—©</div>
          </div>
          <div class="option-card" data-value="ä¸­é€”é†’äº†">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cDovL3RlbmZlaTAxLmNmcC5jbi9jcmVhdGl2ZS92Y2cvdmVlci8xNjAwd2F0ZXIvdmVlci0zOTk5NjI5ODUuanBn&sign=yx:a2Gcn5I3WVQXDLg4U85Xu-DRkGo=&tv=400_400" alt="ä¸­é€”é†’äº†">
            <div class="option-label">ä¸­é€”é†’äº†</div>
            <div class="option-desc">å¤šæ¬¡é†’æ¥</div>
          </div>
          <div class="option-card" data-value="æ·±ç¡å°‘">
         <div class="option-img" style="background:#e0f7fa;display:flex;align-items:center;justify-content:center;color:#0097a7;font-weight:bold;">ğŸŒ™</div>
  <div class="option-label">æ·±ç¡å°‘</div>
  <div class="option-desc">æµ…ç¡ä¸ºä¸»</div>
</div>
          <div class="option-card" data-value="åšå™©æ¢¦äº†">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cDovL3RlbmZlaTA1LmNmcC5jbi9jcmVhdGl2ZS92Y2cvdmVlci8xNjAwd2F0ZXIvdmVlci0zNjgxNTMzNTkuanBn&sign=yx:1-uxbs15OKy54Ew5tfQu--NmOk4=&tv=400_400" alt="åšå™©æ¢¦äº†">
            <div class="option-label">åšå™©æ¢¦äº†</div>
            <div class="option-desc">æ¢¦å¢ƒå›°æ‰°</div>
          </div>
        </div>
      </div>

      <!-- é¥®é£Ÿ -->
      <div class="section">
        <div class="section-title">é¥®é£Ÿ<br><small style="font-size:0.8rem;color:#757575;"> æ²‰æµ¸äº«å—ç¾é£Ÿï¼Œç»†åš¼æ…¢å’½</small></div>
        <div class="options-grid" data-category="food">
          <div class="option-card" data-value="åƒå¾—æ­£å¥½">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cHM6Ly9pbWcwOC50b29vcGVuLmNvbS8yMDIxMDkwMS90b29vcGVuX3YxNjIxNTUyMTU1Y2Q5ZWVhOTMtNDBmMS00NzA3LWE4YzQtMzJjYTNiMWNkOTA5LmpwZw==&sign=yx:G82XrrnLdOMsvQ5VpOlH66CtKbA=&tv=400_400" alt="åƒå¾—æ­£å¥½">
            <div class="option-label">åƒå¾—æ­£å¥½</div>
            <div class="option-desc">è¥å…»å‡è¡¡</div>
          </div>
          <div class="option-card" data-value="æ²¡æŒ‰æ—¶åƒ">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cDovL2ltYWdlMTA5LjM2MGRvYy5jb20vRG93bmxvYWRJbWcvMjAyMC8xMC8zMDA5LzIwNTkzNDA3OV8xXzIwMjAxMDMwMDk1OTI5NjE4X3dt&sign=yx:p5HD8J6ddnLaYnttDo07-ToIeAI=&tv=400_400" alt="æ²¡æŒ‰æ—¶åƒ">
            <div class="option-label">æ²¡æŒ‰æ—¶åƒ</div>
            <div class="option-desc">ä½œæ¯ä¸è§„å¾‹</div>
          </div>
          <div class="option-card" data-value="æ²¡åƒé¥±">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cDovL2ltZzk1LjY5OXBpYy5jb20veHNqLzBiL3Y5L28xLmpwZyEvZncvNzAwL3dhdGVybWFyay91cmwvTDNoemFpOTNZWFJsY2w5a1pYUmhhV3d5TG5CdVp3L2FsaWduL3NvdXRoZWFzdA==&sign=yx:8yDsay1bqgXQOq515FCxSwtYaf8=&tv=400_400" alt="æ²¡åƒé¥±">
            <div class="option-label">æ²¡åƒé¥±</div>
            <div class="option-desc">è¥å…»ä¸è¶³</div>
          </div>
          <div class="option-card" data-value="åƒæ’‘äº†">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cHM6Ly93eDIuc2luYWltZy5jbi9sYXJnZS8wMDV6MmJER2d5MWhuazZmem5ycWlqMzJjMDJjMGU4My5qcGc=&sign=yx:zsDYoDOm9IQIFn_nRO9BWb3g8Fo=&tv=400_400" alt="åƒæ’‘äº†">
            <div class="option-label">åƒæ’‘äº†</div>
            <div class="option-desc">è¿‡é‡è¿›é£Ÿ</div>
          </div>
          <div class="option-card" data-value="ç”Ÿå†·æ²¹è…»">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cDovL2FsaWZlaTA1LmNmcC5jbi9jcmVhdGl2ZS92Y2cvdmVlci8xNjAwd2F0ZXIvdmVlci0zNzc0OTIyODQuanBn&sign=yx:lU1113TFD-X11lQT1BgPtEwipH8=&tv=400_400" alt="ç”Ÿå†·æ²¹è…»">
            <div class="option-label">ç”Ÿå†·æ²¹è…»</div>
            <div class="option-desc">ä¸å¥åº·é€‰æ‹©</div>
          </div>
        </div>
      </div>

      <!-- æ´»åŠ¨ -->
      <div class="section">
        <div class="section-title"> æ´»åŠ¨<br><small style="font-size:0.8rem;color:#757575;">é€‚é‡è¿åŠ¨å“¦</small></div>
        <div class="options-grid" data-category="activity">
          <div class="option-card" data-value="è¿åŠ¨äº†">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cDovL2ltZy5hbGljZG4uY29tL2Jhby91cGxvYWRlZC9pMi8xNzgyMjcwMDcvTzFDTjAxMHZzSlF1MjFkR0VieUJBMnJfISExNzgyMjcwMDcuanBn&sign=yx:J4a-_9gwbZCzojLucpz1iiIbYtk=&tv=400_400" alt="è¿åŠ¨äº†">
            <div class="option-label">è¿åŠ¨äº†</div>
            <div class="option-desc">ä¸“ä¸šé”»ç‚¼</div>
          </div>
          <div class="option-card" data-value="æ•£æ­¥äº†">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cHM6Ly9wMC5zc2wucWhpbWdzMS5jb20vdDAxYjM3MGRiMTRhYmM3Y2RlNC5qcGc=&sign=yx:4CM3rBDFI5LQBtkMvnbDvBcbQRI=&tv=400_400" alt="æ•£æ­¥äº†">
            <div class="option-label">æ•£æ­¥äº†</div>
            <div class="option-desc">è½»æ¾æ­¥è¡Œ</div>
          </div>
<div class="option-card" data-value="æ™’å¤ªé˜³">
  <div class="option-img" style="background:#fff8e1;display:flex;align-items:center;justify-content:center;color:#ff9800;font-weight:bold;">â˜€ï¸</div>
  <div class="option-label">æ™’å¤ªé˜³</div>
  <div class="option-desc">è¡¥å……ç»´ç”Ÿç´ D</div>
</div>
          <div class="option-card" data-value="æ‹‰ä¼¸äº†">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cHM6Ly90Ny5iYWlkdS5jb20vaXQvdT0yNjE0NDkyMDAxLDQwMjUzODE2NyZmbT0xOTM=&sign=yx:iPaUv4Afvis_3PQfezWb0OlaiyA=&tv=400_400" alt="æ‹‰ä¼¸äº†">
            <div class="option-label">æ‹‰ä¼¸äº†</div>
            <div class="option-desc">æŸ”éŸ§æ€§è®­ç»ƒ</div>
          </div>
          <div class="option-card" data-value="è½»åº¦æ´»åŠ¨">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cHM6Ly9pbWcuemNvb2wuY24vY29tbXVuaXR5LzAxMjcyNDVkNDc4Y2YwYTgwMTIxODdmNDI0NWQyMC5qcGc_eC1vc3MtcHJvY2Vzcz1pbWFnZS9hdXRvLW9yaWVudCwxL3Jlc2l6ZSxtX2xmaXQsd18xMjgwLGxpbWl0XzEvc2hhcnBlbiwxMDAvcXVhbGl0eSxxXzEwMA==&sign=yx:Srl5Mr3wxG9fZq_MUMOlNCAjUNc=&tv=400_400" alt="è½»åº¦æ´»åŠ¨">
            <div class="option-label">è½»åº¦æ´»åŠ¨</div>
            <div class="option-desc">æ—¥å¸¸åŠ³ä½œ</div>
          </div>
          <div class="option-card" data-value="éœ€è¦ä¼‘æ¯">
            <img class="option-img" src="https://kkimgs.yisou.com/ims?kt=url&at=smstruct&key=aHR0cDovL2ltZzk1LjY5OXBpYy5jb20veHNqLzBhLzA0L2lpLmpwZyEvZncvNzAwL3dhdGVybWFyay91cmwvTDNoemFpOTNZWFJsY2w5a1pYUmhhV3d5TG5CdVp3L2FsaWduL3NvdXRoZWFzdA==&sign=yx:dZcoGlOqA_0ilsKdCfRrVeXQ9Yo=&tv=400_400" alt="éœ€è¦ä¼‘æ¯">
            <div class="option-label">éœ€è¦ä¼‘æ¯</div>
            <div class="option-desc">è¿‡åº¦ç–²åŠ³</div>
          </div>
        </div>
      </div>

      <!-- èº«ä½“æ„Ÿå— -->
      <div class="section">
        <div class="section-title">èº«ä½“è‡ªæŸ¥<br><small style="font-size:0.8rem;color:#757575;">å…³æ³¨èº«ä½“ç»†å¾®å˜åŒ–</small></div>
        <div class="options-grid" data-category="body">
          <div class="option-card" data-value="æ„Ÿè§‰ä¸é”™ï¼">
            <div class="option-img" style="background:#e8f5e8;display:flex;align-items:center;justify-content:center;color:#4caf50;font-weight:bold;">ğŸ˜Š</div>
            <div class="option-label">æ„Ÿè§‰ä¸é”™ï¼</div>
            <div class="option-desc">çŠ¶æ€è‰¯å¥½</div>
          </div>
          <div class="option-card" data-value="çœ¼ç›å¹²æ¶©">
            <div class="option-img" style="background:#ffebee;display:flex;align-items:center;justify-content:center;color:#f44336;">ğŸ‘ï¸</div>
            <div class="option-label">çœ¼ç›å¹²æ¶©</div>
            <div class="option-desc">ç”¨çœ¼è¿‡åº¦</div>
          </div>
          <div class="option-card" data-value="é¼»å¡ä¸é€š">
            <div class="option-img" style="background:#e3f2fd;display:flex;align-items:center;justify-content:center;color:#2196f3;">ğŸ‘ƒ</div>
            <div class="option-label">é¼»å¡ä¸é€š</div>
            <div class="option-desc">å¯èƒ½æ„Ÿå†’</div>
          </div>
          <div class="option-card" data-value="å’³å—½ä¸é€‚">
            <div class="option-img" style="background:#fff3e0;display:flex;align-items:center;justify-content:center;color:#ff9800;">ğŸ¤§</div>
            <div class="option-label">å’³å—½ä¸é€‚</div>
            <div class="option-desc">å‘¼å¸é“æ•æ„Ÿ</div>
          </div>
          <div class="option-card" data-value="è‚©é¢ˆä¸é€‚">
            <div class="option-img" style="background:#f3e5f5;display:flex;align-items:center;justify-content:center;color:#9c27b0;">ğŸ’†</div>
            <div class="option-label">è‚©é¢ˆä¸é€‚</div>
            <div class="option-desc">ä¹…åå¯¼è‡´</div>
          </div>
          <div class="option-card" data-value="è…°èƒŒé…¸ç—›">
            <div class="option-img" style="background:#e1f5fe;display:flex;align-items:center;justify-content:center;color:#03a9f4;">ğŸ¦´</div>
            <div class="option-label">è…°èƒŒé…¸ç—›</div>
            <div class="option-desc">å§¿åŠ¿ä¸è‰¯</div>
          </div>
          <div class="option-card" data-value="è…¿éƒ¨æ²‰é‡">
            <div class="option-img" style="background:#e8f5e8;display:flex;align-items:center;justify-content:center;color:#4caf50;">ğŸ¦µ</div>
            <div class="option-label">è…¿éƒ¨æ²‰é‡</div>
            <div class="option-desc">å¾ªç¯ä¸ç•…</div>
          </div>
          <div class="option-card" data-value="å¤´ç—›å¤´æ™•">
            <div class="option-img" style="background:#ffebee;display:flex;align-items:center;justify-content:center;color:#f44336;">ğŸ§ </div>
            <div class="option-label">å¤´ç—›å¤´æ™•</div>
            <div class="option-desc">å‹åŠ›æˆ–ç–²åŠ³</div>
          </div>
          <div class="option-card" data-value="å‹åŠ›è¿‡å¤§">
            <div class="option-img" style="background:#fff8e1;display:flex;align-items:center;justify-content:center;color:#ff9800;">ğŸ˜°</div>
            <div class="option-label">å‹åŠ›è¿‡å¤§</div>
            <div class="option-desc">æƒ…ç»ªç´§å¼ </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ç»Ÿè®¡é¡µ -->
    <div id="stats-page" class="page">
      <div class="tabs">
        <button class="tab-btn active" data-period="today">ä»Šå¤©</button>
        <button class="tab-btn" data-period="yesterday">æ˜¨å¤©</button>
        <button class="tab-btn" data-period="week">æœ¬å‘¨</button>
        <button class="tab-btn" data-period="month">æœ¬æœˆ</button>
        <button class="tab-btn" data-period="all">å…¨éƒ¨è®°å½•</button>
      </div>
      <div id="stats-content"></div>
    </div>

    <div class="nav-buttons">
      <button onclick="switchPage('main')">ä»Šæ—¥æ‰“å¡</button>
      <button class="secondary" onclick="switchPage('stats')">æŸ¥çœ‹ç»Ÿè®¡</button>
    </div>
  </div>

  <script>
    // --- å°†å‡½æ•°å®šä¹‰ç§»åˆ°æ­¤å¤„ ---
    const categoryConfig = {
      sleep: { title: 'ç¡çœ æƒ…å†µ' },
      food: { title: 'é¥®é£Ÿæƒ…å†µ' },
      activity: { title: 'æ´»åŠ¨æƒ…å†µ' },
      body: { title: 'èº«ä½“æ„Ÿå—' }
    };

    let currentPeriod = 'today';

    // åˆ‡æ¢é¡µé¢
    function switchPage(page) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(`${page}-page`).classList.add('active');
      if (page === 'stats') renderStats();
    }

    // å¤šé€‰é€»è¾‘
    document.querySelectorAll('.option-card').forEach(card => {
      card.addEventListener('click', function () {
        this.classList.toggle('selected');
        const category = this.closest('.options-grid').dataset.category;
        const today = new Date().toISOString().split('T')[0];

        const selectedValues = Array.from(
          this.parentElement.querySelectorAll('.option-card.selected')
        ).map(c => c.dataset.value);

        localStorage.setItem(`haohao_${category}_${today}`, JSON.stringify(selectedValues));
      });
    });

    // ç«æ˜Ÿå›¾æ ‡ä¸æ–‡å­—æ˜¾ç¤ºé€»è¾‘
    const marsIcon = document.getElementById('mars-icon');
    const subtitleText = document.getElementById('subtitle-text');

    // ä» localStorage åŠ è½½æœˆäº®ç‚¹äº®å’Œæ–‡å­—æ˜¾ç¤ºçŠ¶æ€
    const isMarsLit = localStorage.getItem('mars_lit') === 'true';
    const isTextVisible = localStorage.getItem('subtitle_text_visible') === 'true';

    if (isMarsLit) {
      marsIcon.classList.add('lit');
    }
    if (isTextVisible) {
      subtitleText.classList.add('visible');
    }

    marsIcon.addEventListener('click', () => {
      const isCurrentlyLit = marsIcon.classList.contains('lit');
      const isCurrentlyVisible = subtitleText.classList.contains('visible');

      if (isCurrentlyLit && isCurrentlyVisible) {
        // å¦‚æœå½“å‰ç‚¹äº®ä¸”æ–‡å­—å¯è§ï¼Œåˆ™ç†„ç­å¹¶éšè—æ–‡å­—
        marsIcon.classList.remove('lit');
        subtitleText.classList.remove('visible');
        localStorage.setItem('mars_lit', 'false');
        localStorage.setItem('subtitle_text_visible', 'false');
      } else {
        // å¦åˆ™ï¼Œç‚¹äº®å¹¶æ˜¾ç¤ºæ–‡å­—
        marsIcon.classList.add('lit');
        subtitleText.classList.add('visible');
        localStorage.setItem('mars_lit', 'true');
        localStorage.setItem('subtitle_text_visible', 'true');
      }
    });

    // åŠ è½½ä»Šæ—¥å·²é€‰ï¼ˆå¤šé€‰ï¼‰
    window.onload = () => {
      const today = new Date().toISOString().split('T')[0];
      ['sleep', 'food', 'activity', 'body'].forEach(cat => {
        const saved = localStorage.getItem(`haohao_${cat}_${today}`);
        if (saved) {
          try {
            const values = JSON.parse(saved);
            if (Array.isArray(values)) {
              values.forEach(val => {
                const card = [...document.querySelectorAll(`[data-category="${cat}"] .option-card`)]
                  .find(c => c.dataset.value === val);
                if (card) card.classList.add('selected');
              });
            }
          } catch (e) {
            console.warn('Failed to parse saved data for', cat, e);
          }
        }
      });
    };

    // æ—¶é—´åˆ‡æ¢
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentPeriod = btn.dataset.period;
        renderStats();
      });
    });

    // è·å–æ—¥æœŸèŒƒå›´
    function getDateRange(period) {
      const now = new Date();
      const dates = [];
      if (period === 'today') {
        dates.push(formatDate(now));
      } else if (period === 'yesterday') {
        const yest = new Date(now);
        yest.setDate(now.getDate() - 1);
        dates.push(formatDate(yest));
      } else if (period === 'week') {
        for (let i = 6; i >= 0; i--) {
          const d = new Date(now);
          d.setDate(now.getDate() - i);
          dates.push(formatDate(d));
        }
      } else if (period === 'month') {
        const year = now.getFullYear();
        const month = now.getMonth();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        for (let i = Math.min(daysInMonth, 31) - 1; i >= 0; i--) {
          const d = new Date(year, month, now.getDate() - i);
          dates.push(formatDate(d));
        }
      } else if (period === 'all') {
        // 'all' æ¨¡å¼ä¸ä½¿ç”¨æ­¤å‡½æ•°ï¼Œè¿”å›ç©ºæ•°ç»„
        return [];
      }
      return dates;
    }

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    // æ¸²æŸ“ç»Ÿè®¡ï¼ˆæ”¯æŒå¤šé€‰å’Œæ¬¡æ•°ç»Ÿè®¡ï¼‰
    function renderStats() {
      const container = document.getElementById('stats-content');
      container.innerHTML = '';

      if (currentPeriod === 'all') {
        // æ¸²æŸ“æ¬¡æ•°ç»Ÿè®¡
        renderCountStats(container);
      } else {
        // æ¸²æŸ“æŒ‰æ—¥æœŸç»Ÿè®¡
        renderDateStats(container);
      }
    }

    function renderDateStats(container) {
      const dates = getDateRange(currentPeriod);

      dates.forEach(date => {
        let hasData = false;
        const dateSection = document.createElement('div');
        dateSection.style.marginBottom = '20px';
        const dateHeader = document.createElement('h3');
        dateHeader.textContent = date;
        dateHeader.style.marginBottom = '12px';
        dateHeader.style.color = '#555';
        dateSection.appendChild(dateHeader);

        ['sleep', 'food', 'activity', 'body'].forEach(cat => {
          const saved = localStorage.getItem(`haohao_${cat}_${date}`);
          if (saved) {
            try {
              const values = JSON.parse(saved);
              if (Array.isArray(values) && values.length > 0) {
                hasData = true;
                const item = document.createElement('div');
                item.className = 'stat-item';
                item.innerHTML = `<strong>${categoryConfig[cat].title}ï¼š</strong> ${values.join('ã€')}`;
                dateSection.appendChild(item);
              }
            } catch (e) {
              console.warn('Failed to parse stats for', cat, date, e);
            }
          }
        });

        if (hasData) {
          container.appendChild(dateSection);
        }
      });

      if (container.innerHTML === '') {
        container.innerHTML = '<div class="no-data">æš‚æ— è®°å½•</div>';
      }
    }

    function renderCountStats(container) {
      // æ”¶é›†æ‰€æœ‰é€‰é¡¹åŠå…¶å‡ºç°æ¬¡æ•°
      const counter = {};

      // åˆå§‹åŒ–æ‰€æœ‰å¯èƒ½é€‰é¡¹ä¸º 0ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯åŠ¨æ€ç»Ÿè®¡ï¼‰
     const allOptions = {
  sleep: ['ç¡å¾—å¾ˆå¥½', 'å¤±çœ äº†', 'æ—©é†’äº†', 'ä¸­é€”é†’äº†', 'åšå™©æ¢¦äº†', 'æ·±ç¡å°‘'],
  food: ['åƒå¾—æ­£å¥½', 'æ²¡æŒ‰æ—¶åƒ', 'æ²¡åƒé¥±', 'åƒæ’‘äº†', 'ç”Ÿå†·æ²¹è…»'],
  activity: ['è¿åŠ¨äº†', 'æ•£æ­¥äº†', 'æ‹‰ä¼¸äº†', 'è½»åº¦æ´»åŠ¨', 'éœ€è¦ä¼‘æ¯', 'æ™’å¤ªé˜³'],
  body: ['æ„Ÿè§‰ä¸é”™ï¼', 'çœ¼ç›å¹²æ¶©', 'é¼»å¡ä¸é€š', 'å’³å—½ä¸é€‚', 'è‚©é¢ˆä¸é€‚', 'è…°èƒŒé…¸ç—›', 'è…¿éƒ¨æ²‰é‡', 'å¤´ç—›å¤´æ™•', 'å‹åŠ›è¿‡å¤§']
};

      // åˆå§‹åŒ–è®¡æ•°å™¨
      Object.keys(allOptions).forEach(cat => {
        allOptions[cat].forEach(opt => {
          counter[opt] = 0;
        });
      });

      // éå†æ‰€æœ‰ localStorage ä¸­çš„ç›¸å…³æ•°æ®
      const dates = getAllDates();
      dates.forEach(date => {
        ['sleep', 'food', 'activity', 'body'].forEach(cat => {
          const key = `haohao_${cat}_${date}`;
          const saved = localStorage.getItem(key);
          if (saved) {
            try {
              const values = JSON.parse(saved);
              if (Array.isArray(values)) {
                values.forEach(val => {
                  if (counter.hasOwnProperty(val)) {
                    counter[val]++;
                  } else {
                    // å¦‚æœæœ‰æ–°é€‰é¡¹ï¼ˆæœªæ¥æ‰©å±•ï¼‰ï¼Œä¹Ÿè®¡å…¥
                    counter[val] = (counter[val] || 0) + 1;
                  }
                });
              }
            } catch (e) {
              console.warn('Parse error:', key, e);
            }
          }
        });
      });

      // è®¡ç®—è¶‹åŠ¿ï¼ˆæœ€è¿‘ä¸€å‘¨ vs æ›´æ—©ä¸€å‘¨ï¼‰
      const trendData = calculateTrends(dates, allOptions);

      // æŒ‰ç±»åˆ«åˆ†ç»„æ˜¾ç¤º
      let hasData = false;
      Object.entries(categoryConfig).forEach(([cat, config]) => {
        const items = allOptions[cat].map(opt => {
          const count = counter[opt] || 0;
          let trend = 'â¡ï¸'; // é»˜è®¤æŒå¹³
          if (trendData[opt] !== undefined) {
            if (trendData[opt] > 0) trend = 'ğŸ“ˆ'; // ä¸Šå‡
            else if (trendData[opt] < 0) trend = 'ğŸ“‰'; // ä¸‹é™
          }
          return { option: opt, count: count, trend: trend };
        }).filter(item => item.count > 0).sort((a, b) => b.count - a.count); // é«˜é¢‘åœ¨å‰

        if (items.length > 0) {
          hasData = true;
          const section = document.createElement('div');
          section.style.marginBottom = '24px';

          const title = document.createElement('h3');
          title.textContent = config.title;
          title.style.marginBottom = '12px';
          title.style.color = '#555';
          section.appendChild(title);

          items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'stat-item counts';
            div.innerHTML = `<span><strong>${item.option}</strong>ï¼š${item.count} æ¬¡</span><span class="stat-trend">${item.trend}</span>`;
            section.appendChild(div);
          });

          container.appendChild(section);
        }
      });

      if (!hasData) {
        container.innerHTML = '<div class="no-data">æš‚æ— æ‰“å¡è®°å½•</div>';
      }
    }

    // è·å–æ‰€æœ‰å·²å­˜å‚¨çš„æ—¥æœŸé”®
    function getAllDates() {
      const dates = new Set();
      for (let key in localStorage) {
        if (key.startsWith('haohao_')) {
          const parts = key.split('_');
          if (parts.length >= 3) {
            const date = parts[2] + '-' + parts[3] + '-' + parts[4]; // é‡æ–°ç»„è£…æ—¥æœŸ
            if (/^\d{4}-\d{2}-\d{2}$/.test(date)) {
              dates.add(date);
            }
          }
        }
      }
      return Array.from(dates).sort((a, b) => new Date(a) - new Date(b)); // ä»æ—§åˆ°æ–°æ’åº
    }

    // è®¡ç®—è¶‹åŠ¿ï¼šæœ€è¿‘ä¸€å‘¨ vs ä¸Šä¸€å‘¨
    function calculateTrends(dates, allOptions) {
      const now = new Date();
      const oneWeekAgo = new Date(now);
      oneWeekAgo.setDate(now.getDate() - 7);

      const twoWeeksAgo = new Date(now);
      twoWeeksAgo.setDate(now.getDate() - 14);

      const recentCounter = {};
      const previousCounter = {};

      // åˆå§‹åŒ–è®¡æ•°å™¨
      Object.keys(allOptions).forEach(cat => {
        allOptions[cat].forEach(opt => {
          recentCounter[opt] = 0;
          previousCounter[opt] = 0;
        });
      });

      dates.forEach(date => {
        const dateObj = new Date(date);
        let targetCounter = null;

        if (dateObj >= oneWeekAgo) {
          targetCounter = recentCounter;
        } else if (dateObj >= twoWeeksAgo) {
          targetCounter = previousCounter;
        }

        if (targetCounter) {
          ['sleep', 'food', 'activity', 'body'].forEach(cat => {
            const key = `haohao_${cat}_${date}`;
            const saved = localStorage.getItem(key);
            if (saved) {
              try {
                const values = JSON.parse(saved);
                if (Array.isArray(values)) {
                  values.forEach(val => {
                    if (targetCounter.hasOwnProperty(val)) {
                      targetCounter[val]++;
                    }
                  });
                }
              } catch (e) {
                console.warn('Parse error for trend calc:', key, e);
              }
            }
          });
        }
      });

      const trendMap = {};
      Object.keys(allOptions).forEach(cat => {
        allOptions[cat].forEach(opt => {
          const recent = recentCounter[opt] || 0;
          const previous = previousCounter[opt] || 0;
          trendMap[opt] = recent - previous; // æ­£æ•°è¡¨ç¤ºä¸Šå‡ï¼Œè´Ÿæ•°è¡¨ç¤ºä¸‹é™
        });
      });

      return trendMap;
    }
  </script>
</body>
</html>
